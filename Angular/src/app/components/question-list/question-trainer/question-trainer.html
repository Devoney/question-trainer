<div class="card">
	<div class="card-header">
		<div class="trainer-header">
			<div class="trainer-header-left">
				<app-icon-button
					icon="redo-alt"
					[argument]="true"
					(buttonClick)="toggleRepeat()"
					[color]="repeat ? '#000000' : '#CCCCCC'"
					[label]="'trainer.repeatToggleLabel' | transloco"
					size="m"
				/>
			</div>
			<div class="trainer-header-title h5">{{ 'trainer.title' | transloco }}</div>
			<div class="trainer-header-right">
				<button
					mat-raised-button
					color="primary"
					[attr.aria-label]="'trainer.startAria' | transloco"
					(click)="start()"
					[disabled]="!canStart"
				>
					{{ 'trainer.start' | transloco }}
				</button>
			</div>
		</div>
		<div class="trainer-ai-settings">
			<div class="ai-toggle">
				<label>
					<input
						type="checkbox"
						[checked]="useAiGrading"
						(change)="toggleAiGrading($event)"
					/>
					{{ 'trainer.ai.toggle' | transloco }}
				</label>
			</div>
		</div>
	</div>
	<div class="card-body text-left">
		@if (!hasQuestion && !hasQuestionsInList) {
			<div class="text-center">
				@if (showStatistics) {
					<p [attr.aria-label]="'trainer.stats.aria' | transloco">
						{{ 'trainer.stats.prefix' | transloco }}
						<span class="stats-wrong-count">{{ statisticsView.wrongCount }}</span>
						{{ 'trainer.stats.incorrect' | transloco }}
						<span class="stats-correct-count">{{ statisticsView.correctCount }}</span>
						{{ 'trainer.stats.correct' | transloco }}
					</p>
				}
				<span [attr.aria-label]="'trainer.instructions.aria' | transloco">
					{{ 'trainer.instructions.buildList' | transloco }}
				</span>
			</div>
		}
		@if (!hasQuestion && hasQuestionsInList) {
			<div class="text-center">
				{{ 'trainer.instructions.pressStart' | transloco }}
			</div>
		}
		@if (hasQuestion) {
			<div>
				<div class="font-weight-bold">{{ 'trainer.labels.question' | transloco }}</div>
				<div [innerHTML]="questionHtml" [attr.aria-label]="'trainer.aria.questionHtml' | transloco"></div>
				<div class="font-weight-bold answer">{{ 'trainer.labels.yourAnswer' | transloco }}</div>
				@if (!showAnswer && hasQuestion) {
					<div>
						<ckeditor
							[editor]="editor"
							[(ngModel)]="answerGiven"
							[config]="editorConfig"
							[disabled]="!hasQuestion"
						></ckeditor>
					</div>
				}
				@if (showAnswer) {
					<div [innerHTML]="answerGiven"></div>
				}
				<div class="font-weight-bold answer">{{ 'trainer.labels.expectedAnswer' | transloco }}</div>
				@if (!useAiGrading && !showAnswer && hasQuestion) {
					<div class="show-answer-banner" (click)="showAnswer = true">
						{{ 'trainer.showAnswer' | transloco }}
					</div>
				}
				@if (useAiGrading && hasQuestion) {
					<div class="ai-check-container">
						@if (!aiNeedsContinue) {
							<button mat-stroked-button color="primary" [disabled]="!canCheckAnswer" (click)="checkAnswerWithAi()">
								{{ 'trainer.checkAnswer' | transloco }}
							</button>
						}
						@if (aiCheckInProgress) {
							<div class="ai-checking">{{ 'trainer.checking' | transloco }}</div>
						}
						@if (aiError) {
							<div class="ai-error">{{ aiError }}</div>
						}
					</div>
				}
				@if (showAnswer) {
					<div [attr.aria-label]="'trainer.aria.answerHtml' | transloco" [innerHTML]="answerHtml"></div>
				}
				@if (aiFeedback && aiNeedsContinue && aiWasCorrect === false) {
					<div class="ai-feedback">
						<div class="ai-feedback-label">{{ 'trainer.ai.explanationLabel' | transloco }}</div>
						<div class="ai-feedback-text">{{ aiFeedback }}</div>
					</div>
				}
			</div>
		}
	</div>
	<div class="card-footer">
		<div class="trainer-footer">
			@if (!useAiGrading) {
				<div class="trainer-footer-left">
					<button
						mat-raised-button
						color="warn"
						[attr.aria-label]="'trainer.wrongAria' | transloco"
						[disabled]="!hasQuestion || !showAnswer"
						(click)="answerIsWrong()"
					>
						{{ 'trainer.wrong' | transloco }}
						@if (hasQuestion) {
							<span>({{ statisticsView.wrongCount }})</span>
						}
					</button>
				</div>
			}
			<div class="trainer-footer-spacer"></div>
			@if (!useAiGrading) {
				<div class="trainer-footer-right">
					<button
						mat-raised-button
						color="accent"
						[attr.aria-label]="'trainer.correctAria' | transloco"
						[disabled]="!hasQuestion || !showAnswer"
						(click)="answerIsCorrect()"
					>
						{{ 'trainer.correct' | transloco }}
						@if (hasQuestion) {
							<span>({{ statisticsView.correctCount }})</span>
						}
					</button>
				</div>
			}
			@if (useAiGrading && aiNeedsContinue && aiWasCorrect === false) {
				<div class="trainer-footer-right">
					<button
						mat-raised-button
						color="primary"
						[attr.aria-label]="'trainer.continueAria' | transloco"
						(click)="continueAfterAiCheck()"
					>
						{{ 'trainer.continue' | transloco }}
					</button>
				</div>
			}
		</div>
	</div>
