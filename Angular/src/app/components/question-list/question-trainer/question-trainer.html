<div class="card">
	<div class="card-header">
		<div class="row">
			<div class="col-2 text-left">
				<app-icon-button
					icon="redo-alt"
					[argument]="true"
					(buttonClick)="toggleRepeat()"
					[color]="repeat ? '#000000' : '#CCCCCC'"
					[label]="'trainer.repeatToggleLabel' | transloco"
					size="m"
				/>
				<div class="ai-toggle">
					<label>
						<input
							type="checkbox"
							[checked]="useAiGrading"
							(change)="toggleAiGrading($event)"
						/>
						{{ 'trainer.ai.toggle' | transloco }}
					</label>
				</div>
			</div>
			<div class="col-8 text-center h5">{{ 'trainer.title' | transloco }}</div>
			<div class="col-2 text-right">
				<button
					[attr.aria-label]="'trainer.startAria' | transloco"
					class="btn"
					[class.btn-primary]="canStart"
					[class.btn-secondary]="!canStart"
					(click)="start()"
					[disabled]="!canStart"
				>
					{{ 'trainer.start' | transloco }}
				</button>
			</div>
		</div>
	</div>
	<div class="card-body text-left">
		<div *ngIf="!hasQuestion && !hasQuestionsInList" class="text-center">
			<p *ngIf="showStatistics" [attr.aria-label]="'trainer.stats.aria' | transloco">
				{{ 'trainer.stats.prefix' | transloco }}
				<span class="stats-wrong-count">{{ statisticsView.wrongCount }}</span>
				{{ 'trainer.stats.incorrect' | transloco }}
				<span class="stats-correct-count">{{ statisticsView.correctCount }}</span>
				{{ 'trainer.stats.correct' | transloco }}
			</p>
			<span [attr.aria-label]="'trainer.instructions.aria' | transloco">
				{{ 'trainer.instructions.buildList' | transloco }}
			</span>
		</div>
		<div *ngIf="!hasQuestion && hasQuestionsInList" class="text-center">
			{{ 'trainer.instructions.pressStart' | transloco }}
		</div>
		<div *ngIf="hasQuestion">
			<div class="font-weight-bold">{{ 'trainer.labels.question' | transloco }}</div>
			<div [innerHTML]="questionHtml" [attr.aria-label]="'trainer.aria.questionHtml' | transloco"></div>
			<div class="font-weight-bold answer">{{ 'trainer.labels.yourAnswer' | transloco }}</div>
			<div *ngIf="!showAnswer && hasQuestion">
				<ckeditor
					[editor]="editor"
					[(ngModel)]="answerGiven"
					[config]="editorConfig"
					[disabled]="!hasQuestion"
				></ckeditor>
			</div>
			<div *ngIf="showAnswer" [innerHTML]="answerGiven"></div>
			<div class="font-weight-bold answer">{{ 'trainer.labels.expectedAnswer' | transloco }}</div>
			<div
				class="show-answer-banner"
				*ngIf="!useAiGrading && !showAnswer && hasQuestion"
				(click)="showAnswer = true"
			>
				{{ 'trainer.showAnswer' | transloco }}
			</div>
			<div *ngIf="useAiGrading && hasQuestion" class="ai-check-container">
				<button
					*ngIf="!aiNeedsContinue"
					class="btn btn-secondary"
					[disabled]="!canCheckAnswer"
					(click)="checkAnswerWithAi()"
				>
					{{ 'trainer.checkAnswer' | transloco }}
				</button>
				<div *ngIf="aiCheckInProgress" class="ai-checking">{{ 'trainer.checking' | transloco }}</div>
				<div *ngIf="aiError" class="ai-error">{{ aiError }}</div>
			</div>
			<div [attr.aria-label]="'trainer.aria.answerHtml' | transloco" *ngIf="showAnswer" [innerHTML]="answerHtml"></div>
			<div *ngIf="aiFeedback && aiNeedsContinue && aiWasCorrect === false">
				<div class="ai-feedback-label font-weight-bold">{{ 'trainer.ai.explanationLabel' | transloco }}</div>
				<div class="ai-feedback-text" class="ai-feedback">{{ aiFeedback }}</div>
			</div>
		</div>
	</div>
	<div class="card-footer">
		<div class="row">
			<div class="col-2 text-left" *ngIf="!useAiGrading">
				<button
					[attr.aria-label]="'trainer.wrongAria' | transloco"
					class="btn btn-danger"
					[disabled]="!hasQuestion || !showAnswer"
					(click)="answerIsWrong()"
				>
					{{ 'trainer.wrong' | transloco }}
					<span *ngIf="hasQuestion">({{ statisticsView.wrongCount }})</span>
				</button>
			</div>
			<div class="col-8"></div>
			<div class="col-2 text-right" *ngIf="!useAiGrading">
				<button
					[attr.aria-label]="'trainer.correctAria' | transloco"
					class="btn btn-success"
					[disabled]="!hasQuestion || !showAnswer"
					(click)="answerIsCorrect()"
				>
					{{ 'trainer.correct' | transloco }}
					<span *ngIf="hasQuestion">({{ statisticsView.correctCount }})</span>
				</button>
			</div>
			<div class="col-2 text-right" *ngIf="useAiGrading && aiNeedsContinue && aiWasCorrect === false">
				<button
					[attr.aria-label]="'trainer.continueAria' | transloco"
					class="btn btn-primary"
					(click)="continueAfterAiCheck()"
				>
					{{ 'trainer.continue' | transloco }}
				</button>
			</div>
		</div>
	</div>
</div>
